---
title: "iWEAR Falls and Lifespace Analyses"
output: pdf_document
---

```{r}
library(ggplot2)
df <- read.csv("iWear_complete_0322.csv")
fields <- colnames(df)
```

# 1. Falls- Descriptive Analysis (History of Falls Questionnaire- hfq)
## Number of fallers (hfq_2)
```{r}
# grep("hfq_2",fields) # 83
df[,c(1,83)]
```

## Number of falls (hfq_2_yes, mean, median, min, max)
```{r}
summary(df$hfq_2_yes)
```

## Description of most common activity at the time of fall (hfq_3; frequency distribution)
```{r}
# table(df$hfq_3)
data.frame(c(1,14,1,2,2,1,8),row.names = c("running","walking","standing",
                                           "getting in/out of bed, chair wheelchair, car",
                                           "climbing on/off chair, stool, ladder",
                                           "participating in sports/exercising, dancing/riding a bicycle",
                                           "other"))
```

## Cause of fall (hfq_4; frequency distribution)
```{r}
# grep("hfq_4___1",fields) # 87
colSums(df[,c(87:107)], na.rm = T) 
```

## Location of fall (hfq_5; frequency distribution)
```{r}
# table(df$hfq_5)
data.frame(c(15,2,12),row.names = c("inside home","inside another building","outside"))
```

## Contribution of environmental hazards (hfq_6; number/percentage of participants)
```{r}
# number
sum(df$hfq_6, na.rm = T)
# percentage
sum(df$hfq_6, na.rm = T)/sum(!is.na(df$hfq_6)) # 29
```

## Which environmental hazards contributed to falls (hfq_6_specify; frequency distribution)
```{r}
# grep("hfq_6_specify___1",fields) # 111 - 125
colSums(df[,c(111:125)], na.rm = T) 
```

## Required help after fall (hfq_8; number/percentage of fallers hfq_2)
```{r}
# number
sum(df$hfq_8, na.rm = T)
# percentage
sum(df$hfq_8, na.rm = T)/sum(!is.na(df$hfq_8)) # 28
```

## Injury after fall (hfq_9; number/percentage of fallers hfq_2)
```{r}
# number
sum(df$hfq_9, na.rm = T)
# percentage
sum(df$hfq_9, na.rm = T)/sum(!is.na(df$hfq_9)) # 29
```

## Recovery after fall (hfq_13_yes; mean, median, min, max days)
```{r}
summary(df$hfq_13_yes)
```

## Most serious injury after fall (hfq_15a; frequency distribution)
```{r}
# table(df$hfq_15a)
data.frame(c(4,12,1,2),row.names = c("cut, laceration",
                                     "bruise or hematoma",
                                     "sprain or strain",
                                     "fracture"))
```

## Location of most serious injury (hfq_15b; frequency distribution)
```{r}
# table(df$hfq_15b)
data.frame(c(5,1,1,3,1,1,1,1,1,1,1),
           row.names = c("head","face",
                         "upper arm","elbow","lower arm",
                         "hand","back",
                         "knee","lower leg",
                         "ankle","other"))
```

# 2. Falls- Association with motor and cognitive function (UHDRS)
## Correlation of number of falls (hfq_2_yes) with UHDRS total motor score (TMS)
```{r}
temp <- df[,c("hfq_2_yes","TMS")]
temp <- na.omit(temp) 
ggplot(temp) +
  geom_point(aes(x = hfq_2_yes, y = TMS)) +
  labs(title = "Correlation of number of falls with TMS",
       subtitle = cor(temp$hfq_2_yes, temp$TMS))
```

## Correlation of number of falls (hfq_2_yes) with UHDRS cognitive 
```{r}
# sdm_correct
temp <- df[,c("hfq_2_yes","sdm_correct")]
temp <- na.omit(temp) 
ggplot(temp) +
  geom_point(aes(x = hfq_2_yes, y = sdm_correct)) +
  labs(title = "Correlation of number of falls with sdm_correct",
       subtitle = cor(temp$hfq_2_yes, temp$sdm_correct))

# sdm_errors
temp <- df[,c("hfq_2_yes","sdm_errors")]
temp <- na.omit(temp) 
ggplot(temp) +
  geom_point(aes(x = hfq_2_yes, y = sdm_errors)) +
  labs(title = "Correlation of number of falls (hfq_2_yes) with sdm_errors",
       subtitle = cor(temp$hfq_2_yes, temp$sdm_errors))
```

# 3. Lifespace- Association with disease severity
## Correlation of lifespace score (ls_score) with UHDRS total motor score (TMS)
```{r}
temp <- df[,c("ls_score","TMS")]
temp <- na.omit(temp) 
ggplot(temp) +
  geom_point(aes(x = ls_score, y = TMS)) +
  labs(title = "Correlation of lifespace score  with TMS",
       subtitle = cor(temp$ls_score, temp$TMS))
```

# 4. Lifespace- Association with Balance and Physical Activity
## Correlation of lifespace score (ls_score) with balance sub-score (balance_subscore)
```{r}
temp <- df[,c("ls_score","Balance_Subscore")]
temp <- na.omit(temp) 
ggplot(temp) +
  geom_point(aes(x = ls_score, y = Balance_Subscore)) +
  labs(title = "Correlation of lifespace score with balance sub-score",
       subtitle = cor(temp$ls_score, temp$Balance_Subscore))
```

## Correlation of lifespace score (ls_score) with self-reported Physical Activity (ipaq_score_post)
```{r}
temp <- df[,c("ls_score","ipaq_score_post")]
temp <- na.omit(temp) 
ggplot(temp) +
  geom_point(aes(x = ls_score, y = ipaq_score_post)) +
  labs(title = "Correlation of lifespace score with ipaq_score_post",
       subtitle = cor(temp$ls_score, temp$ipaq_score_post))
```

## Correlation of lifespace score (ls_score) with actual Physical Activity (number of steps/METs from Geneactiv sensor)
```{r}
temp <- df[,c("as_correct","ls_score","step_count")]
temp <- na.omit(temp) 
ggplot(temp, aes(x = ls_score, y = step_count, label = as_correct)) +
  geom_point() +
  geom_text(aes(label = as_correct), size = 2, hjust = 0, vjust = 0) +
  labs(title = "Correlation of lifespace score with number of steps",
       subtitle = cor(temp$ls_score, temp$step_count))
```

## Correlation of lifespace score (ls_score) with Total Sway area
```{r}
df_ls <- df[,c("as_correct","ls_score")]
df_sway <- read.csv("../APDM/Sitting Postural Sway.csv", header=T, stringsAsFactors=FALSE)
colnames(df_sway)[1] <- c("as_correct")
df_sway$as_correct[1:20] <- paste0("IW",substr(df_sway$as_correct[1:20],3,4),"GHI")
df_merge <- merge(df_sway, df_ls, sort = F)

df_check <- df_merge[,c(1,30,35)]
df_check

temp <- na.omit(df_merge)
ggplot(temp) +
  geom_point(aes(x = ls_score, y = Postural.Sway...Angles...Sway.Area..degrees.2.)) +
  labs(title = "Correlation of lifespace score with Total Sway area",
       subtitle = cor(temp$ls_score, temp$Postural.Sway...Angles...Sway.Area..degrees.2.))
```

# 5. Lifespace- Association with Cognitive and Behavioral Function
## Correlation of lifespace score (ls_score) with Symbol Digit Modality Test correct score (sdm_correct)
```{r}
temp <- df[,c("ls_score","sdm_correct")]
temp <- na.omit(temp) 
ggplot(temp) +
  geom_point(aes(x = ls_score, y = sdm_correct)) +
  labs(title = "Correlation of lifespace score with sdm_correct",
       subtitle = cor(temp$ls_score, temp$sdm_correct))
```

## Correlation of lifespace score (ls_score) with Symbol Digit Modality Test error score (sdm_errors)
```{r}
temp <- df[,c("ls_score","sdm_errors")]
temp <- na.omit(temp) 
ggplot(temp) +
  geom_point(aes(x = ls_score, y = sdm_errors)) +
  labs(title = "Correlation of lifespace score with sdm_errors",
       subtitle = cor(temp$ls_score, temp$sdm_errors))
```
        
## Correlation of lifespace score (ls_score) with Verbal Fluency Test score (vf_subtotal)
```{r}
temp <- df[,c("as_correct","ls_score","vf_subtotal")]
temp <- na.omit(temp) 
ggplot(temp, aes(x = ls_score, y = vf_subtotal, label = as_correct)) +
  geom_point() +
  geom_text(aes(label = as_correct), size = 2, hjust = 0, vjust = 0) +
  labs(title = "Correlation of lifespace score with Verbal Fluency Test score",
       subtitle = cor(temp$ls_score, temp$vf_subtotal))
```

# 6. Lifespace- Association with Functional Limitations
## Correlation of lifespace score (ls_score) with Total Functional Capacity score (TFC)
```{r}
temp <- df[,c("as_correct","ls_score","TFC")]
temp <- na.omit(temp) 
ggplot(temp, aes(x = ls_score, y = TFC, label = as_correct)) +
  geom_point() +
  geom_text(aes(label = as_correct), size = 2, hjust = 0, vjust = 0) +
  labs(title = "Correlation of lifespace score with TFC",
       subtitle = cor(temp$ls_score, temp$TFC))
```

## Correlation of lifespace score (ls_score) with Functional Assessment (FA)
```{r}
temp <- df[,c("as_correct","ls_score","FA")]
temp <- na.omit(temp) 
ggplot(temp, aes(x = ls_score, y = FA, label = as_correct)) +
  geom_point() +
  geom_text(aes(label = as_correct), size = 2, hjust = 0, vjust = 0) +
  labs(title = "Correlation of lifespace score with FA",
       subtitle = cor(temp$ls_score, temp$FA))
```